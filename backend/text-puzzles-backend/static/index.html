<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Text Adventure</title>
</head>
<body>
<textarea id="input" placeholder="Enter command..."></textarea>
<button id="submitButton" onclick="sendCommand()" disabled>Submit</button>
<div id="output"></div>

<audio id="gameSound" src="/static/ping.wav" preload="auto"></audio>

<script>
document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('output').innerText += "Welcome! Processing the room... You'll be able to issue commands once the room is loaded. \n \n";
    runCommand("Look around");
});

function runCommand(command){
    if  (document.getElementById('submitButton') !== null){
        document.getElementById('submitButton').disabled = true
    }
    fetch('/api/game', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({command: command})
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById('output').innerText += data.response;
        document.getElementById('submitButton').disabled = false;
        document.getElementById('gameSound').play();
    })
}

function sendCommand() {
    const command = document.getElementById('input').value;
    document.getElementById('output').innerText += "\n\n Command sent! Command was \n"+ command + "\nIt takes a while for the AI to respond, a sound will ring when it's done. \n \n ";
    runCommand(command)
}
</script>
</body>
</html>